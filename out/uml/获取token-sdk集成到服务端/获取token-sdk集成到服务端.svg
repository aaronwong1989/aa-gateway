<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg"
  contentScriptType="application/ecmascript" contentStyleType="text/css" height="1107px"
  preserveAspectRatio="none" style="width:817px;height:1107px;" version="1.1" viewBox="0 0 817 1107"
  width="817px" zoomAndPan="magnify">
  <defs>
    <filter height="300%" id="f1diafkest570v" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2.0"/>
      <feColorMatrix in="blurOut" result="blurOut2" type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/>
    </filter>
  </defs>
  <g>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="881.9004"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="69" y="172.7949"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="220.2808"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="297" y="172.7949"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="292.2983"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="297" y="684.8882"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="156.772"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="509" y="204.5493"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="68.772"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="509" y="759.8882"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="31.7544"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="736" y="878.1689"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="459.6021"
      style="stroke: #000000; stroke-width: 2.0;" width="782" x="13" y="588.0933"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="74" x2="74"
      y1="57.7773" y2="1064.6953"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="302" x2="302"
      y1="57.7773" y2="1064.6953"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="514" x2="514"
      y1="57.7773" y2="1064.6953"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="741" x2="741"
      y1="57.7773" y2="1064.6953"/>
    <rect fill="#FEFECE" filter="url(#f1diafkest570v)" height="33.1201"
      style="stroke: #A80036; stroke-width: 1.5;" width="98" x="23" y="19.6572"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs"
      textLength="84" x="30" y="42.7012">开发者服务端
    </text>
    <rect fill="#FEFECE" filter="url(#f1diafkest570v)" height="33.1201"
      style="stroke: #A80036; stroke-width: 1.5;" width="98" x="23" y="1063.6953"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs"
      textLength="84" x="30" y="1086.7393">开发者服务端
    </text>
    <rect fill="#FEFECE" filter="url(#f1diafkest570v)" height="33.1201"
      style="stroke: #A80036; stroke-width: 1.5;" width="98" x="251" y="19.6572"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs"
      textLength="84" x="258" y="42.7012">开放平台网关
    </text>
    <rect fill="#FEFECE" filter="url(#f1diafkest570v)" height="33.1201"
      style="stroke: #A80036; stroke-width: 1.5;" width="98" x="251" y="1063.6953"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs"
      textLength="84" x="258" y="1086.7393">开放平台网关
    </text>
    <rect fill="#FEFECE" filter="url(#f1diafkest570v)" height="33.1201"
      style="stroke: #A80036; stroke-width: 1.5;" width="126" x="449" y="19.6572"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs"
      textLength="112" x="456" y="42.7012">开放平台认证中心
    </text>
    <rect fill="#FEFECE" filter="url(#f1diafkest570v)" height="33.1201"
      style="stroke: #A80036; stroke-width: 1.5;" width="126" x="449" y="1063.6953"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs"
      textLength="112" x="456" y="1086.7393">开放平台认证中心
    </text>
    <rect fill="#FEFECE" filter="url(#f1diafkest570v)" height="33.1201"
      style="stroke: #A80036; stroke-width: 1.5;" width="84" x="697" y="19.6572"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs"
      textLength="70" x="704" y="42.7012">应用微服务
    </text>
    <rect fill="#FEFECE" filter="url(#f1diafkest570v)" height="33.1201"
      style="stroke: #A80036; stroke-width: 1.5;" width="84" x="697" y="1063.6953"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs"
      textLength="70" x="704" y="1086.7393">应用微服务
    </text>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="881.9004"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="69" y="172.7949"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="220.2808"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="297" y="172.7949"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="292.2983"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="297" y="684.8882"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="156.772"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="509" y="204.5493"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="68.772"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="509" y="759.8882"/>
    <rect fill="#FFFFFF" filter="url(#f1diafkest570v)" height="31.7544"
      style="stroke: #A80036; stroke-width: 1.0;" width="10" x="736" y="878.1689"/>
    <rect fill="#EEEEEE" filter="url(#f1diafkest570v)" height="3"
      style="stroke: #EEEEEE; stroke-width: 1.0;" width="802" x="3" y="89.6545"/>
    <line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="805" y1="89.6545" y2="89.6545"/>
    <line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="805" y1="92.6545" y2="92.6545"/>
    <rect fill="#EEEEEE" filter="url(#f1diafkest570v)" height="25.7544"
      style="stroke: #000000; stroke-width: 2.0;" width="128" x="340" y="77.7773"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="114" x="346" y="96.6753">获取Access Token
    </text>
    <polygon fill="#A80036" points="285,168.7949,295,172.7949,285,176.7949,289,172.7949"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="79" x2="291" y1="172.7949" y2="172.7949"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="86" y="150.1841">1
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="42" x="97" y="132.4297">&lt;GET&gt;
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="169" x="101" y="150.1841">/token?appid=xxx&amp;echo=xxx
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="142" x="97" y="167.9385">&amp;sign=Sign(appid+echo,
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="243" y="167.9385">S1
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="4" x="259" y="167.9385">)
    </text>
    <polygon fill="#A80036" points="497,200.5493,507,204.5493,497,208.5493,501,204.5493"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="307" x2="503" y1="204.5493"
      y2="204.5493"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="314" y="199.6929">2
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="82" x="325" y="199.6929">&lt;GET&gt; /token
    </text>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="519" x2="561"
      y1="236.3037" y2="236.3037"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="561" x2="561"
      y1="236.3037" y2="249.3037"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="520" x2="561"
      y1="249.3037" y2="249.3037"/>
    <polygon fill="#A80036" points="530,245.3037,520,249.3037,530,253.3037,526,249.3037"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="526" y="231.4473">3
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="537" y="231.4473">P1
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="26" x="553" y="231.4473">验签
    </text>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="519" x2="561"
      y1="316.5669" y2="316.5669"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="561" x2="561"
      y1="316.5669" y2="329.5669"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="520" x2="561"
      y1="329.5669" y2="329.5669"/>
    <polygon fill="#A80036" points="530,325.5669,520,329.5669,530,333.5669,526,329.5669"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="526" y="293.9561">4
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="71" x="537" y="276.2017">生成token并
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="168" x="537" y="293.9561">加密RSA(appid+token+echo,
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="709" y="293.9561">P1
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="4" x="725" y="293.9561">)
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="167" x="537" y="311.7104">签名Sign(appid+token+echo,
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="708" y="311.7104">S2
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="4" x="724" y="311.7104">)
    </text>
    <polygon fill="#A80036" points="318,357.3213,308,361.3213,318,365.3213,314,361.3213"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="312" x2="513" y1="361.3213"
      y2="361.3213"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="324" y="356.4648">5
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="167" x="335" y="356.4648">下发加密token，禁用Refresh
    </text>
    <polygon fill="#A80036" points="90,389.0757,80,393.0757,90,397.0757,86,393.0757"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="84" x2="301" y1="393.0757" y2="393.0757"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="96" y="388.2192">6
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="84" x="107" y="388.2192">下发加密token
    </text>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="79" x2="121"
      y1="424.8301" y2="424.8301"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="121" x2="121"
      y1="424.8301" y2="437.8301"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="80" x2="121"
      y1="437.8301" y2="437.8301"/>
    <polygon fill="#A80036" points="90,433.8301,80,437.8301,90,441.8301,86,437.8301"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="86" y="419.9736">7
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="146" x="97" y="419.9736">解出token：deRSA(密文,
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="247" y="419.9736">S1
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="4" x="263" y="419.9736">)
    </text>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="79" x2="121"
      y1="469.5845" y2="469.5845"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="121" x2="121"
      y1="469.5845" y2="482.5845"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="80" x2="121"
      y1="482.5845" y2="482.5845"/>
    <polygon fill="#A80036" points="90,478.5845,80,482.5845,90,486.5845,86,482.5845"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="86" y="464.728">8
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="97" y="464.728">P2
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="26" x="113" y="464.728">验签
    </text>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="79" x2="121"
      y1="514.3389" y2="514.3389"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="121" x2="121"
      y1="514.3389" y2="527.3389"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="80" x2="121"
      y1="527.3389" y2="527.3389"/>
    <polygon fill="#A80036" points="90,523.3389,80,527.3389,90,531.3389,86,527.3389"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="7" x="86" y="509.4824">9
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="62" x="97" y="509.4824">save token
    </text>
    <rect fill="#EEEEEE" filter="url(#f1diafkest570v)" height="3"
      style="stroke: #EEEEEE; stroke-width: 1.0;" width="802" x="3" y="557.2161"/>
    <line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="805" y1="557.2161" y2="557.2161"/>
    <line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="805" y1="560.2161" y2="560.2161"/>
    <rect fill="#EEEEEE" filter="url(#f1diafkest570v)" height="25.7544"
      style="stroke: #000000; stroke-width: 2.0;" width="178" x="315" y="545.3389"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="164" x="321" y="564.2368">使用Access Token访问API
    </text>
    <path d="M13,588.0933 L74,588.0933 L74,597.0933 L64,607.0933 L13,607.0933 L13,588.0933 "
      fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/>
    <rect fill="none" height="459.6021" style="stroke: #000000; stroke-width: 2.0;" width="782"
      x="13" y="588.0933"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="28" y="603.9912">alt
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="125" x="89" y="602.6992">[loop in validity period]
    </text>
    <polygon fill="#A80036" points="285,680.8882,295,684.8882,285,688.8882,289,684.8882"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="79" x2="291" y1="684.8882" y2="684.8882"/>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="14" x="86" y="653.4001">11
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="141" x="104" y="626.7686">&lt;POST&gt; /api/service/foo
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="113" x="104" y="644.5229">+AES(data,randK1)
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="84" x="104" y="662.2773">+RSA(randK1,
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="192" y="662.2773">P2
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="8" x="208" y="662.2773">))
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="67" x="104" y="680.0317">+Sign(data,
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="175" y="680.0317">S1
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="4" x="191" y="680.0317">)
    </text>
    <path d="M307,634.5022 L307,661.5022 L532,661.5022 L532,644.5022 L522,634.5022 L307,634.5022 "
      fill="#FBFB77" filter="url(#f1diafkest570v)" style="stroke: #A80036; stroke-width: 1.0;"/>
    <path d="M522,634.5022 L522,644.5022 L532,644.5022 L522,634.5022 " fill="#FBFB77"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="204" x="313" y="654.4001">data=appid+token+transJson+echo
    </text>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="307" x2="354"
      y1="747.1514" y2="747.1514"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="354" x2="354"
      y1="747.1514" y2="760.1514"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313" x2="354"
      y1="760.1514" y2="760.1514"/>
    <polygon fill="#A80036" points="323,756.1514,313,760.1514,323,764.1514,319,760.1514"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="14" x="319" y="724.5405">12
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="75" x="337" y="706.7861">deRSA(密文,
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="416" y="706.7861">S2
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="61" x="432" y="706.7861">)&gt;&gt;randK1
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="169" x="337" y="724.5405">deAES(密文,randK1) &gt;&gt; data
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="337" y="742.2949">P1
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="26" x="353" y="742.2949">验签
    </text>
    <polygon fill="#A80036" points="497,792.9058,507,796.9058,497,800.9058,501,796.9058"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="307" x2="503" y1="796.9058"
      y2="796.9058"/>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="14" x="314" y="792.0493">13
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="135" x="332" y="792.0493">oAuth验证(appid,token)
    </text>
    <polygon fill="#A80036" points="318,824.6602,308,828.6602,318,832.6602,314,828.6602"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="312" x2="513"
      y1="828.6602" y2="828.6602"/>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="14" x="324" y="823.8037">14
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="52" x="342" y="823.8037">验证通过
    </text>
    <polygon fill="#A80036" points="724,874.1689,734,878.1689,724,882.1689,728,878.1689"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="307" x2="730" y1="878.1689"
      y2="878.1689"/>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="14" x="314" y="864.4353">15
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="51" x="332" y="855.5581">&lt;POST&gt;
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="81" x="336" y="873.3125">/foo transJson
    </text>
    <polygon fill="#A80036" points="318,905.9233,308,909.9233,318,913.9233,314,909.9233"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="312" x2="740" y1="909.9233"
      y2="909.9233"/>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="14" x="324" y="905.0669">16
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="52" x="342" y="905.0669">respJson
    </text>
    <polygon fill="#A80036" points="90,973.1865,80,977.1865,90,981.1865,86,977.1865"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <line style="stroke: #A80036; stroke-width: 1.0;" x1="84" x2="301" y1="977.1865" y2="977.1865"/>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="14" x="96" y="954.5757">17
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="58" x="114" y="936.8213">Response
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="176" x="114" y="954.5757">+AES(respJson+echo,randK1)
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="130" x="114" y="972.3301">+Sign(respJson+echo,
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="248" y="972.3301">S2
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="4" x="264" y="972.3301">)
    </text>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="79" x2="121"
      y1="1026.6953" y2="1026.6953"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="121" x2="121"
      y1="1026.6953" y2="1039.6953"/>
    <line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="80" x2="121"
      y1="1039.6953" y2="1039.6953"/>
    <polygon fill="#A80036" points="90,1035.6953,80,1039.6953,90,1043.6953,86,1039.6953"
      style="stroke: #A80036; stroke-width: 1.0;"/>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="14" x="86" y="1012.9617">18
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="120" x="104" y="1004.0845">deAES(密文,randK1)
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold"
      lengthAdjust="spacingAndGlyphs" textLength="16" x="104" y="1021.8389">P2
    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs"
      textLength="26" x="120" y="1021.8389">验签
    </text>
    <text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs"
      textLength="206" x="599" y="14.46">开发者SDK集成在服务端：获取Access Token
    </text><!--
@startuml

header 开发者SDK集成在服务端：获取Access Token

participant 开发者服务端 as dev
participant 开放平台网关 as opb
participant 开放平台认证中心 as auth
participant 应用微服务 as service


==获取Access Token==
autonumber "<font color=blue><b>"
dev -> opb: <GET>\n /token?appid=xxx&echo=xxx\n&sign=Sign(appid+echo, <b>S1</b>)
activate dev
activate opb
opb -> auth: <GET> /token
activate auth
auth - -> auth: <b>P1</b>验签
auth - -> auth: 生成token并\n加密RSA(appid+token+echo, <b>P1</b>)\n签名Sign(appid+token+echo, <b>S2</b>)
auth -> opb: 下发加密token，禁用Refresh
deactivate auth
opb -> dev: 下发加密token
deactivate opb
dev - -> dev: 解出token：deRSA(密文, <b>S1</b>)
dev - -> dev: <b>P2</b>验签
dev - -> dev: save token

==使用Access Token访问API==
autonumber 11 "<font color=red><b>"
alt loop in validity period
  dev -> opb: <POST> /api/service/foo \n+AES(data,randK1)\n+RSA(randK1, <b>P2</b>))\n+Sign(data, <b>S1</b>)
  note right
  data=appid+token+transJson+echo
  end note

  activate opb
  opb - -> opb: deRSA(密文, <b>S2</b>)>>randK1 \ndeAES(密文,randK1) >> data\n<b>P1</b>验签
  activate auth
  opb -> auth: oAuth验证(appid,token)
  auth - -> opb: 验证通过
  deactivate auth
  opb -> service: <POST>\n /foo transJson
  activate service
  service -> opb: respJson
  deactivate service
  opb -> dev: Response \n+AES(respJson+echo,randK1)\n+Sign(respJson+echo, <b>S2</b>)
  deactivate opb
  dev - ->dev: deAES(密文,randK1)\n<b>P2</b>验签
end
deactivate dev


@enduml

PlantUML version 1.2018.12(Sun Oct 21 18:15:15 CST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_192-b12
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
-->
  </g>
</svg>